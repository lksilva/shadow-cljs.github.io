# Publicando Bibliotecas[[publish]]

Bibliotecas ClojureScript são publicadas nos repositórios `mavens` assim como as feita em Clojure. Mais comumente são publicadas no https://clojars.org/[Clojars] mas todos os outros padrões de repositório maven também funcionam.

`shadow-cljs` por si só não tem suporte para publicar mas desde que bibliotecas ClojureScrip são apenas arquivos não compilados publicados em um JAR (basicamente apenas um arquivo ZIP comprimido) qualquer ferramena que é capaz de publicar para o maven vai funcionar. (ex. `mvn`, `gradle`, `lein`, etc). Nenhuma compilação extra ou outros passos são obrigatórios para publicas. O compilador ClojureScript e portanto shadow-cljs não é involvido.

## Leiningen [[publish-lein]]

Existe uma grande variedade de opções para publicar bibliotecas e eu atualmente recomendo https://leiningen.org/[Leiningen]. A configuração é muito direta e não requer muita configuração.

IMPORTANWTE: Isso não significa que você tem que usar Leiningen durante o desenvolvimento da biblioteca. É recomendado usar Leiningen apenas para publicar mas use `shadow-cljs` de outra forma. Você vai precisar copiar a atual definition `:dependencies` uma vez pra você publicar. Entretando relembre de manter o desenvolvimento relacionado a dependência.

Assumindo que você já esta usando a estrutura de projeto recomendada onde todos as suas fontes primarias são localizadas no `src/main` você pode publicar com um simples `project.clj`.

```clojure
(defproject your.cool/library "1.0.0"
  :description "Does cool stuff"
  :url "https://the.inter.net/wherever"

  ;; this is optional, add what you want or remove it
  :license {:name "Eclipse Public License"
            :url "http://www.eclipse.org/legal/epl-v10.html"}

  :dependencies
  ;; always use "provided" for Clojure(Script)
  [[org.clojure/clojurescript "1.10.520" :scope "provided"]
   [some.other/library "1.0.0"]

  :source-paths
  ["src/main"])
```

This will generate the required `pom.xml` and put all sources from `src/main` into the published `.jar` file. All you need to run is `lein deploy clojars` to publish it. When doing this for the first time you'll first need to setup proper authentication. Please refer to the official  https://github.com/technomancy/leiningen/blob/stable/doc/DEPLOY.md[Leiningen] and https://github.com/clojars/clojars-web/wiki/Tutorial[Clojars] documentation on how to set that up.

### Disable JAR Signing

Leiningen defaults to signing libraries via GPG before publishing which is a good default but given that this can be a hassle to setup and not many people are actually verifying the signatures you can disable that step via adding a simple `:repositories` config to the `project.clj`.

```clojure
(defproject your.cool/library "1.0.0"
  ...
  :repositories
  {"clojars" {:url "https://clojars.org/repo"
              :sign-releases false}}
  ...)
```

### Keep your JAR clean

If you write tests or user other development related code for your library make sure to keep them in `src/dev` or `src/test` to avoid publishing them together with the library.

Also avoid generating output to `resources/*` since Leiningen and other tools may include those files into the `.jar` which may cause problems for downstream users. Your `.jar` should ONLY contains the actual source files, no compiled code at all.

IMPORTANT: You can and should verify that everything is clean by running `lein jar` and inspecting the files that end up in it via `jar -tvf target/library-1.0.0.jar`.

## Declaring JS dependencies [[publish-deps-cljs]]

Please note that currently only `shadow-cljs` has a clean automatic interop story with `npm`. That may represent a problem for users of your libraries using other tools. You may want to consider providing a CLJSJS fallback and/or publishing extra documentation for `webpack` related workflows.

You can declare `npm` dependencies directly by including a `deps.cljs` with `:npm-deps` in your project (eg. `src/main/deps.cljs`).

.Example src/main/deps.cljs
```clojure
{:npm-deps {"the-thing" "1.0.0"}}
```

You can also provide extra `:foreign-libs` definitions here. They won't affect `shadow-cljs` but might help other tools.

